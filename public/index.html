<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Board</title>

<style>
body{margin:0;background:#111;color:white;font-family:Arial;}
.board{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  display:grid;
  grid-template-columns:repeat(10,60px);
  grid-template-rows:repeat(10,60px);
  gap:4px;
}
.cell{
  display:flex;justify-content:center;align-items:center;
  border-radius:8px;font-weight:bold;
  position:relative;font-size:18px;
}
.tokenOnBoard{position:absolute;bottom:2px;right:4px;font-size:28px;}
#players{position:absolute;left:20px;top:20px;}
#qrBox{position:absolute;right:20px;top:20px;}
#overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.85);
  display:flex;justify-content:center;align-items:center;
  opacity:0;pointer-events:none;
}
#overlay.show{opacity:1;}
#overlayBox{
  background:#000;border:3px solid #fff;
  padding:40px 60px;border-radius:16px;font-size:32px;
}
</style>
</head>
<body>

<div id="players"></div>
<div id="qrBox"><img src="/qr" width="140"></div>
<div class="board" id="board"></div>
<div id="overlay"><div id="overlayBox"></div></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const board = document.getElementById("board");
const playersDiv = document.getElementById("players");
const overlay = document.getElementById("overlay");
const overlayBox = document.getElementById("overlayBox");

const cellMap = {};

function colorFor(i){
  return `hsl(${(i-1)*3.6},80%,55%)`;
}
function snake(r,c){
  const b=r*10;
  return (r%2===0)?b+c+1:b+(10-c);
}

// build board
for(let r=9;r>=0;r--){
  for(let c=0;c<10;c++){
    const n=snake(r,c);
    const cell=document.createElement("div");
    cell.className="cell";
    cell.style.background=colorFor(n);
    cell.style.color=(n%10<5)?"#000":"#fff";
    cell.textContent=n;
    board.appendChild(cell);
    cellMap[n]=cell;
  }
}

socket.on("updatePlayers",(players)=>{
  playersDiv.innerHTML="<h3>Παίκτες</h3>";
  players.forEach(p=>{
    playersDiv.innerHTML+=`${p.token} ${p.name} — ${p.score}<br>`;
  });
});

socket.on("updatePositions",(players)=>{
  document.querySelectorAll(".tokenOnBoard").forEach(e=>e.remove());
  players.forEach(p=>{
    if(p.position>0){
      const t=document.createElement("div");
      t.className="tokenOnBoard";
      t.textContent=p.token;
      cellMap[p.position].appendChild(t);
    }
  });
});

socket.on("showOverlay",(text)=>{
  overlayBox.textContent=text;
  overlay.classList.add("show");
  setTimeout(()=>overlay.classList.remove("show"),4000);
});
</script>
</body>
</html>
