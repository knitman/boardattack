<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Board</title>

<style>
body{margin:0;background:#111;color:white;font-family:Arial;}

/* BOARD */
.board{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  display:grid;
  grid-template-columns:repeat(10,60px);
  grid-template-rows:repeat(10,60px);
  gap:4px;
}
.cell{
  display:flex;justify-content:center;align-items:center;
  border-radius:8px;font-weight:bold;
  position:relative;font-size:18px;
}
.tokenOnBoard{
  position:absolute;bottom:2px;right:4px;font-size:28px;
}

/* LEFT PANEL */
#panel{
  position:absolute;
  left:20px;
  top:20px;
  width:220px;
}

#controls{
  background:#000;
  padding:10px;
  border:2px solid #fff;
  border-radius:10px;
  margin-bottom:10px;
}

#playersList{
  background:#000;
  padding:10px;
  border:2px solid #fff;
  border-radius:10px;
  max-height:260px;
  overflow-y:auto;
}

/* QR */
#qrBox{position:absolute;right:20px;top:20px;}

/* OVERLAY */
#overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.85);
  display:flex;justify-content:center;align-items:center;
  opacity:0;pointer-events:none;
}
#overlay.show{opacity:1;}
#overlayBox{
  background:#000;border:3px solid #fff;
  padding:40px 60px;border-radius:16px;font-size:32px;
}

button{
  margin-top:6px;
  font-size:16px;
  padding:6px 12px;
}
</style>
</head>
<body>

<div id="panel">

  <div id="controls">
    <div id="scoreSetup">
      Î ÏŒÎ½Ï„Î¿Î¹ ÎÎ¯ÎºÎ·Ï‚:
      <input type="number" id="targetInput" value="50" style="width:60px;">
      <button onclick="setTarget()">ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
    </div>

    <div id="gameControls" style="display:none;">
      <button onclick="startGame()">â–¶ï¸ Start</button>
      <button onclick="restartGame()">ğŸ” Restart</button>
    </div>
  </div>

  <div id="playersList">
    <b>Î Î±Î¯ÎºÏ„ÎµÏ‚</b><br>
  </div>

</div>

<div id="qrBox">
  <img src="/qr" width="140">
</div>

<div class="board" id="board"></div>

<div id="overlay"><div id="overlayBox"></div></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const board = document.getElementById("board");
const playersList = document.getElementById("playersList");
const overlay = document.getElementById("overlay");
const overlayBox = document.getElementById("overlayBox");

function setTarget(){
  const val = parseInt(document.getElementById("targetInput").value);
  socket.emit("setTargetScore", val);

  document.getElementById("scoreSetup").style.display="none";
  document.getElementById("gameControls").style.display="block";
}

function startGame(){
  overlayBox.textContent="Î¤Î¿ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹ Î¾ÎµÎºÎ¹Î½Î¬!";
  overlay.classList.add("show");
  setTimeout(()=>overlay.classList.remove("show"),2000);
}

function restartGame(){
  location.reload();
}

// ===== BUILD BOARD =====
const cellMap = {};

function colorFor(i){
  return `hsl(${(i-1)*3.6},80%,55%)`;
}
function snake(r,c){
  const b=r*10;
  return (r%2===0)?b+c+1:b+(10-c);
}

for(let r=9;r>=0;r--){
  for(let c=0;c<10;c++){
    const n=snake(r,c);
    const cell=document.createElement("div");
    cell.className="cell";
    cell.style.background=colorFor(n);
    cell.style.color=(n%10<5)?"#000":"#fff";
    cell.textContent=n;
    board.appendChild(cell);
    cellMap[n]=cell;
  }
}

// ===== PLAYERS =====
socket.on("updatePlayers",(players)=>{
  playersList.innerHTML="<b>Î Î±Î¯ÎºÏ„ÎµÏ‚</b><br>";
  players.forEach(p=>{
    playersList.innerHTML+=`${p.token} ${p.name} â€” ${p.score}<br>`;
  });
});

// ===== TOKENS =====
socket.on("updatePositions",(players)=>{
  document.querySelectorAll(".tokenOnBoard").forEach(e=>e.remove());
  players.forEach(p=>{
    if(p.position>0){
      const t=document.createElement("div");
      t.className="tokenOnBoard";
      t.textContent=p.token;
      cellMap[p.position].appendChild(t);
    }
  });
});

// ===== OVERLAY =====
socket.on("showOverlay",(text)=>{
  overlayBox.textContent=text;
  overlay.classList.add("show");
  setTimeout(()=>overlay.classList.remove("show"),3000);
});
</script>
</body>
</html>
