<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Board 1–100</title>

<style>
body{
  margin:0;
  background:#111;
  font-family:Arial, Helvetica, sans-serif;
  overflow:hidden;
  color:white;
}
.board{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  display:grid;
  grid-template-columns:repeat(10,60px);
  grid-template-rows:repeat(10,60px);
  gap:4px;
}
.cell{
  display:flex;
  justify-content:center;
  align-items:center;
  border-radius:8px;
  font-weight:bold;
  font-size:18px;
  position:relative;
}
.tokenOnBoard{
  position:absolute;
  bottom:2px;
  right:4px;
  font-size:28px;
}
#players{
  position:absolute;
  left:20px;
  top:20px;
}
#qrBox{
  position:absolute;
  right:20px;
  top:20px;
  text-align:center;
}
</style>
</head>
<body>

<div id="players"></div>

<div id="qrBox">
  <div>Scan to join</div>
  <img id="qrImg" width="140">
</div>

<div class="board" id="board"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
document.getElementById("qrImg").src="/qr?"+Date.now();
const socket = io();
const playersDiv = document.getElementById("players");
const board = document.getElementById("board");

// ===== BUILD SNAKE BOARD + MAP =====
const cellMap = {}; // number -> DOM cell

function colorFor(i){
  const hue = Math.floor((i-1)*(360/100));
  const light = 45 + ((i % 10) * 3);
  return `hsl(${hue},80%,${light}%)`;
}

function snakeNumber(r,c){
  const base=r*10;
  return (r%2===0)?base+c+1:base+(10-c);
}

for(let r=9;r>=0;r--){
  for(let c=0;c<10;c++){
    const num=snakeNumber(r,c);
    const cell=document.createElement("div");
    cell.className="cell";
    cell.style.background=colorFor(num);
    cell.style.color=(num%10<5)?"#000":"#fff";
    cell.textContent=num;

    board.appendChild(cell);
    cellMap[num]=cell;   // ⭐ ΚΡΑΤΑΜΕ ΤΟ ΣΩΣΤΟ MAP
  }
}

// ===== PLAYERS LIST =====
socket.on("updatePlayers",(players)=>{
  playersDiv.innerHTML="<h3>Παίκτες</h3>";
  players.forEach(p=>{
    const d=document.createElement("div");
    d.textContent=`${p.token} ${p.name}`;
    playersDiv.appendChild(d);
  });
});

// ===== TOKENS ON BOARD (FIXED) =====
socket.on("updatePositions",(players)=>{
  document.querySelectorAll(".tokenOnBoard").forEach(e=>e.remove());

  players.forEach(p=>{
    if(p.position===0) return;

    const targetCell = cellMap[p.position]; // ⭐ σωστό snake cell

    const token = document.createElement("div");
    token.textContent = p.token;
    token.className = "tokenOnBoard";

    targetCell.appendChild(token);
  });
});
</script>
</body>
</html>
